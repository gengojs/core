{"version":3,"sources":["lib/core/index.js"],"names":[],"mappings":"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","file":"lib/core/index.js","sourcesContent":["import pkg from './package';\r\nimport extractify from './modules/extractify';\r\nimport plugify from './modules/plugify/';\r\nimport optify from './modules/optify';\r\nimport debugify from './modules/debugify';\r\nimport _ from 'lodash';\r\n\r\nclass Gengo {\r\n  /* Gengo constructor */\r\n  constructor(options, plugins) {\r\n    /* Gengo properties */\r\n    //Current version\r\n    this.version = pkg.version;\r\n    // Options\r\n    this.options = _.assign((this.options = {}), optify(options));\r\n    // Current server\r\n    this.server = '';\r\n    /* Plugins */\r\n    this.plugins = {\r\n      parsers: [],\r\n      routers: [],\r\n      backends: [],\r\n      apis: [],\r\n      headers: [],\r\n      localizes: [],\r\n      handlers: [],\r\n    };\r\n    // Initialize plugins\r\n    this.use(plugins);\r\n    // Debug core\r\n    debugify('core',\r\n      'version:', this.version,\r\n      'options:', this.options,\r\n      'server:', this.server);\r\n    debugify('core-plugins', 'plugins:', this.plugins);\r\n    // Call backend plugin\r\n    this.plugins.backends.forEach((plugin) => {\r\n      var {\r\n        name, version, type\r\n      } = plugin.package;\r\n      this['_' + type] = {\r\n        package: plugin.package,\r\n        options: this.options[type] || {}\r\n      };\r\n      debugify('core-' + type, 'name:', name, 'version:', version);\r\n      plugin.bind(this)();\r\n    }, this);\r\n  }\r\n  /* i18ns the input*/\r\n  parse(phrase) {\r\n    debugify('core', 'fn:', 'parse');\r\n    var args = arguments;\r\n    // Parser\r\n    this.plugins.parsers.forEach((plugin) => {\r\n      var {\r\n        name, version, type\r\n      } = plugin.package;\r\n      this['_' + type] = {\r\n        package: plugin.package,\r\n        options: this.options[type] || {},\r\n        input: {\r\n          arguments: args,\r\n          length: args.length,\r\n          phrase: phrase,\r\n          other: extractify(args, args.length)\r\n        }\r\n      };\r\n      debugify('core-' + type, 'name:', name, 'version:', version);\r\n      debugify('core-' + type, 'input', this['_' + type].input);\r\n      plugin.bind(this)();\r\n    }, this);\r\n    return this.result;\r\n  }\r\n\r\n  /* Sets the plugins */\r\n  use(plugins) {\r\n    debugify('core', 'fn:', 'use');\r\n    // Add plugins to array when plugify\r\n    // begins its callbacks\r\n    if (plugins)\r\n      plugify(plugins, (main, pkg) => {\r\n        var {\r\n          name, type\r\n        } = pkg;\r\n        // Initialize an object\r\n        this.plugins[type] = {};\r\n        // Set the plugin fn\r\n        this.plugins[type][name] = main;\r\n        // Set the package\r\n        this.plugins[type][name].package = pkg;\r\n        // Insert plugins as callbacks\r\n        this.plugins[type + 's'].push(main);\r\n      }, this);\r\n  }\r\n  /* Middleware for Node frameworks*/\r\n  ship() {\r\n    debugify('core', 'fn:', 'ship');\r\n    // Get the request, response\r\n    var req = arguments[0],\r\n      res = arguments[1] || null,\r\n      next = arguments[2] || null;\r\n    /*Set plugins */\r\n    // Headers\r\n    this.plugins.headers.forEach((plugin) => {\r\n      var {\r\n        name, version, type\r\n      } = plugin.package;\r\n      this['_' + type] = {\r\n        package: plugin.package,\r\n        options: this.options[type] || {}\r\n      };\r\n      debugify('core-' + type, 'name:', name, 'version:', version);\r\n      plugin.bind(this)(req, res);\r\n    }, this);\r\n    // Routers\r\n    this.plugins.routers.forEach((plugin) => {\r\n      var {\r\n        name, version, type\r\n      } = plugin.package;\r\n      this['_' + type] = {\r\n        package: plugin.package,\r\n        options: this.options[type] || {}\r\n      };\r\n      debugify('core-' + type, 'name:', name, 'version:', version);\r\n      plugin.bind(this)(req, res);\r\n    }, this);\r\n    // Localize(s)\r\n    this.plugins.localizes.forEach((plugin) => {\r\n      var {\r\n        name, version, type\r\n      } = plugin.package;\r\n      this['_' + type] = {\r\n        package: plugin.package,\r\n        options: this.options[type] || {}\r\n      };\r\n      debugify('core-' + type, 'name:', name, 'version:', version);\r\n      plugin.bind(this)();\r\n\r\n    }, this);\r\n    /* Apply API */\r\n\r\n    // Koa?\r\n    if (this.isKoa(req) && !_.isEmpty(req)) {\r\n      this.server = 'koa';\r\n      // Apply api to koa\r\n      this.assign(req.request, req.response);\r\n      if (req.req || req.res) this.assign(req.req, req.res);\r\n      if (req.state) this.assign(req.state);\r\n    }\r\n    // Hapi?\r\n    if (this.isHapi(req) && !_.isEmpty(req)) {\r\n      this.server = 'hapi';\r\n      if (req.response)\r\n        if (req.response.variety === 'view')\r\n          this.assign(req.response.source.context);\r\n      this.assign(req);\r\n    }\r\n    // Express ?\r\n    if (this.isExpress(req) && !_.isEmpty(req)) {\r\n      this.server = 'express';\r\n      this.assign(req, res);\r\n      // Apply to API to the view\r\n      if (res && res.locals) this.assign(res.locals);\r\n    }\r\n\r\n    debugify('core', 'server:', this.server);\r\n    // Make sure next exists and call it.\r\n    if (_.isFunction(next)) next();\r\n  }\r\n  assign(req, res) {\r\n    debugify('core', 'fn:', 'assign');\r\n    // Define the API\r\n    this.plugins.apis.forEach((plugin) => {\r\n      var {\r\n        name, version, type\r\n      } = plugin.package;\r\n      this['_' + type] = {\r\n        package: plugin.package,\r\n        options: this.options[type] || {}\r\n      };\r\n      debugify('core-' + type, 'name:', name, 'version:', version);\r\n      plugin.bind(this)();\r\n    }, this);\r\n    // Apply the API\r\n    this.plugins.handlers.forEach((plugin) => {\r\n      var {\r\n        name, version, type\r\n      } = plugin.package;\r\n      this['_' + type] = {\r\n        package: plugin.package,\r\n        options: this.options[type] || {},\r\n        api: this._api.options || {}\r\n      };\r\n      debugify('core-' + type, 'name:', name, 'version:', version);\r\n      plugin.bind(this)(req, res);\r\n    }, this);\r\n  }\r\n  /* Framework detection */\r\n  isKoa(req) {\r\n    return req && !req.raw ? (req.response && req.request) :\r\n      !_.isEmpty(this.server) ? this.server === 'koa' : false;\r\n  }\r\n  isHapi(req) {\r\n    return req ? (req.raw) :\r\n      !_.isEmpty(this.server) ? this.server === 'hapi' : false;\r\n  }\r\n  isExpress(req) {\r\n    return req && !req.raw ? (req && !req.raw && !req.response) :\r\n      !_.isEmpty(this.server) ? this.server === 'express' : false;\r\n  }\r\n}\r\n\r\nexport\r\ndefault (options, plugins) => {\r\n  /*jshint strict:false*/\r\n  return new Gengo(options, plugins);\r\n};"]}